<div class="pure-g">
    <div class="pure-u-1">
        <accordion close-others="true">
            <div ng-repeat="product in payrollProducts" ng-init="x[0] = true">
                <accordion-group is-open="x[$index]" ng-class="{'active' : x[$index]}">
                    <accordion-heading>
                        {{product.agency.name}} <i class="pull-right fa" ng-class="{'fa-chevron-up': status.open, 'fa-chevron-down': !status.open}"></i>
                    </accordion-heading>
                    <div class="pure-u-1 nonepadding">
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-2">
                                <div class="pure-g">
                                    <div class="pure-u-2-5">Consultant </div>
                                    <div class="pure-u-3-5">
                                        <span>{{product.consultant.name}}</span>
                                    </div>
                                    <div class="pure-u-2-5">Branch</div>
                                    <div class="pure-u-3-5">
                                        <span>{{product.branch.name}}</span>
                                    </div>
                                    <div class="pure-u-2-5">Date Added</div>
                                    <div class="pure-u-3-5">
                                        <span>22/22/2222</span>
                                    </div>
                                    <div class="pure-u-2-5">Agency Ref</div>
                                    <div class="pure-u-3-5">
                                        <span>555-555</span>
                                    </div>
                                </div>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <div class="pure-g">
                                    <div class="pure-u-2-5">Margin </div>
                                    <div class="pure-u-3-5">
                                        <span>{{getConstantDescription('margins', product.margin)}}</span>
                                    </div>
                                    <div class="pure-u-2-5">Contact</div>
                                    <div class="pure-u-3-5">
                                        <span>01617131730</span>
                                    </div>
                                    <div class="pure-u-2-5"></div>
                                    <div class="pure-u-3-5">
                                        <a href="mailto:info@originem.co.uk" class="meta-o" style="float: none">info@originem.co.uk</a>
                                    </div>
                                </div>
                            </div>
                            <div class="pure-u-1-1">
                                <p class="entry-title pure-u-1">Exception History
                                    <a class="icon-edit pull-right" href="javascript:void(0);" ng-click="openAgenciesAddingMargin(product)"><i class="fa fa-plus-square-o"></i></a>
                                </p>
                            </div>
                            <div class="pure-u-1">
                                <p class="text-center" ng-show="product.marginException.length == 0"><i>There are no margin exceptions.</i>
                                </p>
                                <table class="table orig-table" ng-show="product.marginException.length > 0">
                                    <thead>
                                        <tr>
                                            <th>Reason</th>
                                            <th>Deduction type</th>
                                            <th>Deduction</th>
                                            <th>Remaining</th>
                                            <th>Amount</th>
                                            <th width="50px"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="exception in product.marginException">
                                            <td>{{getConstantDescription('reasons', exception.reason)}}</td>
                                            <td>{{getConstantDescription('deductiontypes', exception.deductionType)}}</td>
                                            <td>{{exception.deductionDate?(exception.deductionDate | formatDate: 'DD/MM/YYYY'):''}}</td>
                                            <td>{{exception.deductionPeriod}}</td>
                                            <td>{{exception.deductionNumberOfPayroll}}</td>
                                            <td class="text-center" style="white-space: nowrap; width: 50px">
                                                <a href="" ng-click="openAgenciesAddingMargin(product, exception)"><i class="fa fa-edit"></i></a>
                                                <a href="" ng-click="deleteMarginException(product, exception)"><i class="fa fa-trash-o"></i></a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </accordion-group>
            </div>
        </accordion>
    </div>
</div>